# 이벤트 전파

> 과거 프로젝트 진행 시 만났던 에러가 `이벤트 전파`때문이었던 걸 알게돼서 정리해봤다.

<br />

## 1. 상황

- 메뉴 버튼에 마우스가 올라가면 메뉴가 나타났다가 마우스가 메뉴와 버튼을 벗어나면 메뉴가 사라지는 기능을 구현하고 있었다.
- 당시엔 구글링을 통해서 `mouseover`, `mouseout` 이벤트를 찾아서 기능을 구현하려했다.
- 그런데 가장 바깥쪽 `div`를 벗어날 때 `mouseout`이벤트를 발생시키고 싶은데 자식 요소들을 벗어날 때도 이벤트가 발생했고 이를 해결해기위해 `mouseover`이벤트가 바깥쪽에서 발생할 때 메뉴를 꺼주는 방식으로 기능을 구현했다.

## 2. 이벤트 전파

- 이벤트 전파: DOM 트리 상 존재하는 **DOM 요소 노드에서 발생한 이벤트는 DOM 트리를 통해 전파**
- 생성된 이벤트 객체는 이벤트를 발생시킨 DOM 요소인 `event target`을 중심으로 DOM 트리를 통해 전파된다.
- 캡처링 단계(capturing phase): 이벤트가 상위 요소에서 하위 요소 방향으로 전파 (이벤트 객체가 window에서 시작해서 이벤트 타깃 방향으로 전파)
- 타깃 단계(target phase): 이벤트가 이벤트 타깃에 도달 (이벤트 객체가 이벤트를 발생시킨 이벤트 타깃에 도달)
- 버블링 단계(bubbling phase): 이벤트가 하위 요소에서 상위 요소 방향으로 전파 (이벤트 객체는 이벤트 타깃에서 시작해서 window 방향으로 전파)
- 커런트 타겟(event.currentTarget): 이벤트 핸들러를 바인딩한 DOM 요소
- 어트리뷰트/프로퍼티 방식으로 등록한 이벤트 핸들러는 타깃 단계와 버블링 단계의 이벤트만 캐치
- addEventListener 메서드 방식으로 등록한 이벤트 핸들러는 타깃 단계, 버블링 단계뿐만 아니라 캡처링 단계도 선별적으로 캐치할 수 있다. (캡처링 단계의 이벤트를 캐치하려면 addEventListener 메서드의 3번째 인수를 true를 전달, 생략하면 기본값으로 false)
- 캡처링, 버블링 단계를 이용하면 이벤트를 발생시킨 이벤트 타깃의 상위 DOM 요소에서 이벤트를 캐치할 수 있다. (DOM 트리를 통해 전파되는 이벤트는 이벤트 패스에 위치한 모든 DOM 요소에서 캐치할 수 있다.)
- 이벤트 패스: 이벤트가 통과하는 DOM 트리 상의 경로, `Event.prototype.composedPath` 메서드로 확인 가능
- 대부분의 이벤트는 캡처링과 버블링을 통해 전파되나 다음 이벤트는 버블링을 통해 전파되지 않는다.(`event.bubbles`의 값이 false)
  - 포커스 이벤트: `focus/blur` -> 버블링이 되는 대체 이벤트 `focusin/focusout`
  - 리소스 이벤트: `load/unload/abort/error`
  - 마우스 이벤트: `mouseenter/mouseleave` -> 버블링이 되는 대체 이벤트 `mouseover/mouseout`
  - 상위 요소에서 이벤트를 캐치하려면 캡처링 단계에서 이벤트를 캐치해야한다.

## 3. 결론

프로젝트를 진행할 때 버블링 이벤트까지 캐치하는 `mouseover/mouseout` 이벤트를 사용해서 생긴 에러였다. 하위 요소에서 일어나는 이벤트를 캐치하지 않기 위해 커스텀 훅까지 만들었는데 `mouseenter/mouseleave`를 사용하면 쉽게 해결할 수 있을 것 같다...
